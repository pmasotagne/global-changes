<h2 mat-dialog-title class="dialog-header">
  <span class="dialog-title">{{ 'resume.title' | translate }}</span>
  <small *ngIf="data.minutes || data.seconds" class="dialog-timer">
    {{ data.minutes }}min {{ data.seconds }}{{ 'resume.seconds' | translate }}
  </small>
</h2>

<mat-dialog-content class="dialog-body">

  <!-- Summary cards -->
  <div class="summary-cards">

    <!-- Total rows -->
    <div class="summary-card">
      <strong>{{ 'resume.totalLinesProcessed' | translate }}:</strong> {{ data.totalRows }}
    </div>

    <!-- Generic -->
    <ng-container *ngIf="!data.poline && !data.users">
      <div class="summary-card">
        <strong>{{ 'resume.itemsUpdated' | translate }}:</strong> {{ data.updatedCount }}
      </div>
      <div class="summary-card error" *ngIf="data.errorsCount > 0">
        <strong>{{ 'resume.errors' | translate }}:</strong> {{ data.errorsCount }}
      </div>
      <div class="summary-card" *ngIf="data.setId">
        <strong>{{ 'resume.setId' | translate }}:</strong> {{ data.setId }}
      </div>
      <div class="summary-card error" *ngIf="data.setIdError">
        <strong>{{ 'resume.setIdError' | translate }}:</strong> {{ data.setIdError }}
      </div>
    </ng-container>

    <!-- PO line -->
    <ng-container *ngIf="data.poline">
      <div class="summary-card poline">
        <strong>{{ 'resume.poLineCloned' | translate }}:</strong> {{ data.updatedCount }}
      </div>
      <div class="summary-card error" *ngIf="data.errorsCount > 0">
        <strong>{{ 'resume.poLineClonedErrors' | translate }}:</strong> {{ data.errorsCount }}
      </div>
    </ng-container>

    <!-- Users -->
    <ng-container *ngIf="data.users">
      <div class="summary-card users">
        <strong>{{ 'resume.removedUsers' | translate }}:</strong> {{ data.removedCount }}
      </div>
      <div class="summary-card error" *ngIf="data.errorsCount > 0">
        <strong>{{ 'resume.removedUsersErrors' | translate }}:</strong> {{ data.errorsCount }}
      </div>
    </ng-container>

  </div>

  <!-- Error log accordion -->
  <mat-accordion *ngIf="data.errorLog?.length" class="error-accordion">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{ 'resume.errorsDetail' | translate }} ({{ data.errorLog.length }})
        </mat-panel-title>
        <mat-panel-description>
          <button mat-icon-button class="copy-btn"
                  (click)="copyAllIdentifiers(); $event.stopPropagation()"
                  aria-label="Copy all identifiers">
            <mat-icon>content_copy</mat-icon>
          </button>
          <!-- Download CSV -->
         <button mat-icon-button class="download-btn"
                (click)="downloadErrorsCsv(); $event.stopPropagation()"
                aria-label="Download errors as CSV">
          <mat-icon>download</mat-icon>
        </button>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <p class="error-info">
        {{ 'resume.errorDisplayLimit' | translate }}
      </p>

      <ul class="error-list">
        <li *ngFor="let item of data.identifiersLimitedGlobal; let i = index" class="error-entry">
          <div class="error-title"><small>Error {{ i + 1 }}</small></div>
          <div class="error-identifiers" *ngIf="item.value !== null && item.value !== undefined && item.value !== ''">
            <strong>{{ item.key }}:</strong> {{ item.value }}
            <button mat-icon-button class="copy-btn"
                    (click)="copyToClipboard(item.value)"
                    aria-label="Copy identifier">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
          <div class="error-message">{{ item.error }}</div>
        </li>
      </ul>
    </mat-expansion-panel>
  </mat-accordion>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-raised-button color="primary" mat-dialog-close (click)="close()">Close</button>
</mat-dialog-actions>
